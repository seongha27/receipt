<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë„¤ì´ë²„ ë¦¬ë·° ê´€ë¦¬ ì‹œìŠ¤í…œ - ì™„ì „ ë²„ì „</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <style>
        [v-cloak] { display: none; }
    </style>
</head>
<body class="bg-gray-50">
    <div id="app" v-cloak>
        <!-- ë¡œë”© -->
        <div v-if="loading" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white p-8 rounded-lg text-center">
                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"></div>
                <p class="mt-4 text-gray-600">{{ loadingMessage }}</p>
            </div>
        </div>

        <!-- í—¤ë” -->
        <header class="bg-blue-600 text-white shadow-lg">
            <div class="max-w-7xl mx-auto px-4 py-6">
                <div class="flex justify-between items-center">
                    <h1 class="text-2xl font-bold">ğŸš€ ë„¤ì´ë²„ ë¦¬ë·° ê´€ë¦¬ ì‹œìŠ¤í…œ</h1>
                    <div v-if="user" class="flex items-center space-x-4">
                        <span class="text-blue-100">{{ user.full_name || user.username }}ë‹˜</span>
                        <span :class="user.role === 'admin' ? 'bg-red-500' : 'bg-blue-500'" 
                              class="px-3 py-1 rounded text-xs">
                            {{ user.role === 'admin' ? 'ê´€ë¦¬ì' : 'ë¦¬ë·°ì–´' }}
                        </span>
                        <button @click="logout" class="bg-blue-700 hover:bg-blue-800 px-4 py-2 rounded">
                            ë¡œê·¸ì•„ì›ƒ
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- ë¡œê·¸ì¸ í¼ -->
        <div v-if="!user" class="min-h-screen flex items-center justify-center">
            <div class="max-w-md w-full bg-white rounded-lg shadow-md p-8">
                <div class="text-center mb-6">
                    <h2 class="text-3xl font-bold text-gray-800">ë¡œê·¸ì¸</h2>
                    <p class="text-gray-600 mt-2">ë„¤ì´ë²„ ë¦¬ë·° ê´€ë¦¬ ì‹œìŠ¤í…œ</p>
                </div>
                
                <form @submit.prevent="login" class="space-y-4">
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2">ì‚¬ìš©ìëª…</label>
                        <input v-model="loginForm.username" type="text" required
                               class="w-full px-3 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500">
                    </div>
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2">ë¹„ë°€ë²ˆí˜¸</label>
                        <input v-model="loginForm.password" type="password" required
                               class="w-full px-3 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500">
                    </div>
                    <button type="submit" class="w-full bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 font-medium">
                        ë¡œê·¸ì¸
                    </button>
                </form>
                
                <div class="mt-6 p-4 bg-gray-50 rounded-lg">
                    <h3 class="font-bold text-gray-800 mb-2">í…ŒìŠ¤íŠ¸ ê³„ì •</h3>
                    <div class="text-sm text-gray-600 space-y-1">
                        <p><strong>ê´€ë¦¬ì:</strong> admin / admin123</p>
                        <p><strong>ë¦¬ë·°ì–´:</strong> reviewer / reviewer123</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- ë©”ì¸ ëŒ€ì‹œë³´ë“œ -->
        <div v-if="user" class="max-w-7xl mx-auto px-4 py-8">
            
            <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
            <div class="mb-8">
                <nav class="flex space-x-8 border-b border-gray-200">
                    <button @click="activeTab = 'dashboard'" 
                            :class="activeTab === 'dashboard' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700'"
                            class="py-2 px-1 border-b-2 font-medium text-sm whitespace-nowrap">
                        ğŸ“Š ëŒ€ì‹œë³´ë“œ
                    </button>
                    <button @click="activeTab = 'reviews'" 
                            :class="activeTab === 'reviews' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700'"
                            class="py-2 px-1 border-b-2 font-medium text-sm whitespace-nowrap">
                        ğŸ“ ë¦¬ë·° ê´€ë¦¬
                    </button>
                    <button v-if="user.role === 'admin'" @click="activeTab = 'stores'" 
                            :class="activeTab === 'stores' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700'"
                            class="py-2 px-1 border-b-2 font-medium text-sm whitespace-nowrap">
                        ğŸª ì—…ì²´ ê´€ë¦¬
                    </button>
                    <button v-if="user.role === 'admin'" @click="activeTab = 'users'" 
                            :class="activeTab === 'users' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700'"
                            class="py-2 px-1 border-b-2 font-medium text-sm whitespace-nowrap">
                        ğŸ‘¥ ì‚¬ìš©ì ê´€ë¦¬
                    </button>
                    <button v-if="user.role === 'admin'" @click="activeTab = 'google-sheets'" 
                            :class="activeTab === 'google-sheets' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700'"
                            class="py-2 px-1 border-b-2 font-medium text-sm whitespace-nowrap">
                        ğŸ“Š êµ¬ê¸€ ì‹œíŠ¸
                    </button>
                    <button v-if="user.role === 'admin'" @click="activeTab = 'assignments'" 
                            :class="activeTab === 'assignments' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700'"
                            class="py-2 px-1 border-b-2 font-medium text-sm whitespace-nowrap">
                        ğŸ”— í• ë‹¹ ê´€ë¦¬
                    </button>
                </nav>
            </div>

            <!-- ëŒ€ì‹œë³´ë“œ íƒ­ -->
            <div v-if="activeTab === 'dashboard'" class="space-y-6">
                <!-- í†µê³„ ì¹´ë“œë“¤ -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <div class="flex items-center">
                            <div class="w-12 h-12 bg-blue-500 rounded-lg flex items-center justify-center text-white font-bold text-lg">
                                ğŸ“
                            </div>
                            <div class="ml-4">
                                <p class="text-gray-600 text-sm">ì´ ë¦¬ë·°</p>
                                <p class="text-2xl font-bold text-gray-800">{{ stats.total_reviews || 0 }}</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <div class="flex items-center">
                            <div class="w-12 h-12 bg-yellow-500 rounded-lg flex items-center justify-center text-white font-bold text-lg">
                                â³
                            </div>
                            <div class="ml-4">
                                <p class="text-gray-600 text-sm">ì²˜ë¦¬ ëŒ€ê¸°</p>
                                <p class="text-2xl font-bold text-gray-800">{{ stats.pending_reviews || 0 }}</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <div class="flex items-center">
                            <div class="w-12 h-12 bg-green-500 rounded-lg flex items-center justify-center text-white font-bold text-lg">
                                âœ…
                            </div>
                            <div class="ml-4">
                                <p class="text-gray-600 text-sm">ì²˜ë¦¬ ì™„ë£Œ</p>
                                <p class="text-2xl font-bold text-gray-800">{{ stats.completed_reviews || 0 }}</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <div class="flex items-center">
                            <div class="w-12 h-12 bg-red-500 rounded-lg flex items-center justify-center text-white font-bold text-lg">
                                âŒ
                            </div>
                            <div class="ml-4">
                                <p class="text-gray-600 text-sm">ì²˜ë¦¬ ì‹¤íŒ¨</p>
                                <p class="text-2xl font-bold text-gray-800">{{ stats.failed_reviews || 0 }}</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ë¹ ë¥¸ ì‘ì—… -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">âš¡ ë¹ ë¥¸ ì‘ì—…</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <button @click="activeTab = 'reviews'; showReviewForm = true" 
                                class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 text-center">
                            ğŸ“ ìƒˆ ë¦¬ë·° ë“±ë¡
                        </button>
                        <button v-if="user.role === 'admin'" @click="activeTab = 'google-sheets'" 
                                class="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 text-center">
                            ğŸ“Š êµ¬ê¸€ ì‹œíŠ¸ ì—°ë™
                        </button>
                        <button v-if="user.role === 'admin'" @click="processAllPending" 
                                class="bg-purple-600 text-white px-6 py-3 rounded-lg hover:bg-purple-700 text-center">
                            ğŸš€ ì „ì²´ ì²˜ë¦¬ ì‹œì‘
                        </button>
                    </div>
                </div>
            </div>

            <!-- ë¦¬ë·° ê´€ë¦¬ íƒ­ -->
            <div v-if="activeTab === 'reviews'" class="space-y-6">
                <!-- ë¦¬ë·° ë“±ë¡ í¼ -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-bold text-gray-800">ğŸ“ ë¦¬ë·° ë“±ë¡</h3>
                        <button @click="showReviewForm = !showReviewForm" 
                                class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                            {{ showReviewForm ? 'í¼ ìˆ¨ê¸°ê¸°' : 'ìƒˆ ë¦¬ë·° ë“±ë¡' }}
                        </button>
                    </div>
                    
                    <form v-if="showReviewForm" @submit.prevent="submitReview" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ì—…ì²´ ì„ íƒ</label>
                            <select v-model="reviewForm.store_id" required 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                <option value="">ì—…ì²´ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                                <option v-for="store in stores" :key="store.id" :value="store.id">
                                    {{ store.name }} {{ store.location ? `(${store.location})` : '' }}
                                </option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ë¦¬ë·° URL</label>
                            <input v-model="reviewForm.review_url" type="url" required 
                                   placeholder="https://naver.me/... ë˜ëŠ” https://m.place.naver.com/my/review/..."
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            <div class="mt-2 p-3 bg-blue-50 rounded-lg">
                                <p class="text-xs text-blue-700 font-medium">âœ¨ ì§€ì› í˜•ì‹:</p>
                                <p class="text-xs text-blue-600">â€¢ ë‹¨ì¶• URL: https://naver.me/5jBm0HYx</p>
                                <p class="text-xs text-blue-600">â€¢ ì§ì ‘ ë§í¬: https://m.place.naver.com/my/review/...</p>
                            </div>
                        </div>
                        <div class="flex space-x-3">
                            <button type="submit" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700">
                                ë“±ë¡
                            </button>
                            <button @click="showReviewForm = false" type="button" 
                                    class="bg-gray-300 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-400">
                                ì·¨ì†Œ
                            </button>
                        </div>
                    </form>
                </div>

                <!-- ë¦¬ë·° ëª©ë¡ -->
                <div class="bg-white rounded-lg shadow-md overflow-hidden">
                    <div class="px-6 py-4 border-b border-gray-200 flex justify-between items-center">
                        <h3 class="text-lg font-bold text-gray-800">ğŸ“‹ ë¦¬ë·° ëª©ë¡</h3>
                        <button @click="loadReviews" class="text-blue-600 hover:text-blue-800">
                            ğŸ”„ ìƒˆë¡œê³ ì¹¨
                        </button>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ì—…ì²´ëª…</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">URL íƒ€ì…</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ìƒíƒœ</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ë“±ë¡ì¼</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ì‘ì—…</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                <tr v-for="review in reviews" :key="review.id" class="hover:bg-gray-50">
                                    <td class="px-6 py-4 text-sm font-medium text-gray-900">
                                        {{ review.store_name }}
                                    </td>
                                    <td class="px-6 py-4">
                                        <span :class="review.url_type === 'direct' ? 'bg-blue-100 text-blue-800' : 'bg-gray-100 text-gray-800'" 
                                              class="px-2 py-1 text-xs font-medium rounded-full">
                                            {{ review.url_type === 'direct' ? 'ì§ì ‘ ë§í¬' : 'ë‹¨ì¶• URL' }}
                                        </span>
                                    </td>
                                    <td class="px-6 py-4">
                                        <span :class="getStatusColor(review.status)" 
                                              class="px-2 py-1 text-xs font-medium rounded-full">
                                            {{ getStatusText(review.status) }}
                                        </span>
                                    </td>
                                    <td class="px-6 py-4 text-sm text-gray-500">
                                        {{ formatDate(review.created_at) }}
                                    </td>
                                    <td class="px-6 py-4 space-x-2">
                                        <button v-if="review.status === 'pending'" 
                                                @click="processReview(review.id)" 
                                                class="text-blue-600 hover:text-blue-900 text-sm font-medium">
                                            â–¶ï¸ ì²˜ë¦¬
                                        </button>
                                        <button @click="viewReviewDetail(review)" 
                                                class="text-green-600 hover:text-green-900 text-sm font-medium">
                                            ğŸ‘ï¸ ìƒì„¸
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <div v-if="reviews.length === 0" class="text-center py-12 text-gray-500">
                            <p class="text-lg">ğŸ“­ ë“±ë¡ëœ ë¦¬ë·°ê°€ ì—†ìŠµë‹ˆë‹¤</p>
                            <p class="text-sm">ìƒˆ ë¦¬ë·°ë¥¼ ë“±ë¡í•´ë³´ì„¸ìš”!</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ì—…ì²´ ê´€ë¦¬ íƒ­ (ê´€ë¦¬ìë§Œ) -->
            <div v-if="activeTab === 'stores' && user.role === 'admin'" class="space-y-6">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-bold text-gray-800">ğŸª ì—…ì²´ ê´€ë¦¬</h3>
                        <button @click="showStoreForm = !showStoreForm" 
                                class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                            {{ showStoreForm ? 'í¼ ìˆ¨ê¸°ê¸°' : 'ìƒˆ ì—…ì²´ ë“±ë¡' }}
                        </button>
                    </div>
                    
                    <form v-if="showStoreForm" @submit.prevent="submitStore" class="space-y-4 mb-6 p-4 bg-gray-50 rounded-lg">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ì—…ì²´ëª… *</label>
                            <input v-model="storeForm.name" type="text" required 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ì„¤ëª…</label>
                            <textarea v-model="storeForm.description" rows="3"
                                      class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"></textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ìœ„ì¹˜</label>
                            <input v-model="storeForm.location" type="text" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div class="flex space-x-3">
                            <button type="submit" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700">ë“±ë¡</button>
                            <button @click="showStoreForm = false" type="button" 
                                    class="bg-gray-300 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-400">ì·¨ì†Œ</button>
                        </div>
                    </form>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <div v-for="store in stores" :key="store.id" 
                             class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow">
                            <h4 class="font-bold text-gray-900 mb-2">{{ store.name }}</h4>
                            <p class="text-sm text-gray-600 mb-1">{{ store.description || 'ì„¤ëª… ì—†ìŒ' }}</p>
                            <p class="text-sm text-gray-500 mb-3">ğŸ“ {{ store.location || 'ìœ„ì¹˜ ì •ë³´ ì—†ìŒ' }}</p>
                            <div class="flex space-x-2">
                                <button class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded">
                                    ë¦¬ë·° {{ getStoreReviewCount(store.id) }}ê°œ
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- êµ¬ê¸€ ì‹œíŠ¸ ì—°ë™ íƒ­ -->
            <div v-if="activeTab === 'google-sheets' && user.role === 'admin'" class="space-y-6">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">ğŸ“Š êµ¬ê¸€ ì‹œíŠ¸ ì—°ë™</h3>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">êµ¬ê¸€ ì‹œíŠ¸ ID</label>
                            <input v-model="googleSheetForm.sheet_id" type="text" 
                                   placeholder="1ABC123def... (êµ¬ê¸€ ì‹œíŠ¸ URLì—ì„œ ì¶”ì¶œ)"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            <p class="text-xs text-gray-500 mt-1">
                                êµ¬ê¸€ ì‹œíŠ¸ URLì—ì„œ ID ë¶€ë¶„ì„ ë³µì‚¬í•˜ì„¸ìš”: 
                                docs.google.com/spreadsheets/d/<strong>ì—¬ê¸°ê°€ID</strong>/edit
                            </p>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ì¸ì¦ íŒŒì¼ ì—…ë¡œë“œ</label>
                            <input @change="handleCredentialsUpload" type="file" accept=".json" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                            <p class="text-xs text-gray-500 mt-1">
                                Google Cloud Consoleì—ì„œ ë‹¤ìš´ë¡œë“œí•œ credentials.json íŒŒì¼
                            </p>
                        </div>
                        
                        <div class="flex space-x-3">
                            <button @click="setupGoogleSheets" 
                                    class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700">
                                ì—°ê²° ì„¤ì •
                            </button>
                            <button @click="syncWithGoogleSheets" 
                                    class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700">
                                ë°ì´í„° ë™ê¸°í™”
                            </button>
                        </div>
                    </div>
                    
                    <div class="mt-6 p-4 bg-yellow-50 rounded-lg">
                        <h4 class="font-bold text-yellow-800 mb-2">ğŸ“‹ êµ¬ê¸€ ì‹œíŠ¸ ì„¤ì • ë°©ë²•</h4>
                        <ol class="text-sm text-yellow-700 space-y-1 list-decimal list-inside">
                            <li>êµ¬ê¸€ ì‹œíŠ¸ì—ì„œ í—¤ë” ì„¤ì •: A1(ì—…ì²´ëª…), B1(ë¦¬ë·°URL), C1(ë¦¬ë·°ë³¸ë¬¸), D1(ì˜ìˆ˜ì¦ë‚ ì§œ), E1(ë“±ë¡ì¼), F1(ìƒíƒœ)</li>
                            <li>Google Cloud Consoleì—ì„œ Service Account ìƒì„±</li>
                            <li>credentials.json íŒŒì¼ ë‹¤ìš´ë¡œë“œ</li>
                            <li>êµ¬ê¸€ ì‹œíŠ¸ë¥¼ Service Accountì™€ ê³µìœ </li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>

        <!-- ë¦¬ë·° ìƒì„¸ ëª¨ë‹¬ -->
        <div v-if="selectedReview" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto z-50" @click="selectedReview = null">
            <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-lg bg-white" @click.stop>
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-bold text-gray-900">ğŸ” ë¦¬ë·° ìƒì„¸ ì •ë³´</h3>
                    <button @click="selectedReview = null" class="text-gray-400 hover:text-gray-600 text-xl">Ã—</button>
                </div>
                
                <div class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">ì—…ì²´ëª…</label>
                            <p class="mt-1 text-sm text-gray-900 font-medium">{{ selectedReview.store_name }}</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">ìƒíƒœ</label>
                            <span :class="getStatusColor(selectedReview.status)" 
                                  class="mt-1 inline-block px-3 py-1 text-xs font-medium rounded-full">
                                {{ getStatusText(selectedReview.status) }}
                            </span>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700">ë¦¬ë·° URL</label>
                        <div class="mt-1 p-2 bg-gray-50 rounded border">
                            <a :href="selectedReview.review_url" target="_blank" 
                               class="text-blue-600 hover:text-blue-800 text-sm break-all">
                                {{ selectedReview.review_url }}
                            </a>
                        </div>
                    </div>
                    
                    <div v-if="selectedReview.extracted_review_text">
                        <label class="block text-sm font-medium text-gray-700">ğŸ“ ì¶”ì¶œëœ ë¦¬ë·° ë‚´ìš©</label>
                        <div class="mt-1 p-4 bg-green-50 border border-green-200 rounded-lg">
                            <p class="text-sm text-gray-900 whitespace-pre-line">{{ selectedReview.extracted_review_text }}</p>
                        </div>
                    </div>
                    
                    <div v-if="selectedReview.extracted_receipt_date">
                        <label class="block text-sm font-medium text-gray-700">ğŸ“… ì˜ìˆ˜ì¦ ë‚ ì§œ</label>
                        <p class="mt-1 text-sm text-gray-900 font-medium">{{ selectedReview.extracted_receipt_date }}</p>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-500">
                        <div>
                            <label class="block font-medium">ë“±ë¡ì¼</label>
                            <p>{{ formatDate(selectedReview.created_at) }}</p>
                        </div>
                        <div v-if="selectedReview.processed_at">
                            <label class="block font-medium">ì²˜ë¦¬ì¼</label>
                            <p>{{ formatDate(selectedReview.processed_at) }}</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    user: null,
                    token: localStorage.getItem('token'),
                    loading: false,
                    loadingMessage: 'ì²˜ë¦¬ì¤‘...',
                    activeTab: 'dashboard',
                    
                    loginForm: { username: '', password: '' },
                    
                    stats: {},
                    
                    reviews: [],
                    reviewForm: { store_id: '', review_url: '' },
                    showReviewForm: false,
                    selectedReview: null,
                    
                    stores: [],
                    storeForm: { name: '', description: '', location: '' },
                    showStoreForm: false,
                    
                    users: [],
                    userForm: { username: '', email: '', full_name: '', role: 'reviewer', password: '' },
                    showUserForm: false,
                    
                    googleSheetForm: { sheet_id: '' },
                    credentialsFile: null
                }
            },
            
            async mounted() {
                if (this.token) {
                    await this.getCurrentUser();
                }
            },
            
            methods: {
                async apiRequest(url, options = {}) {
                    const config = {
                        ...options,
                        headers: {
                            'Content-Type': 'application/json',
                            ...(this.token && { 'Authorization': `Bearer ${this.token}` }),
                            ...options.headers
                        }
                    };
                    
                    try {
                        const response = await axios(url, config);
                        return response.data;
                    } catch (error) {
                        if (error.response?.status === 401) {
                            this.logout();
                        }
                        throw error;
                    }
                },
                
                async login() {
                    this.loading = true;
                    this.loadingMessage = 'ë¡œê·¸ì¸ ì¤‘...';
                    try {
                        const formData = new FormData();
                        formData.append('username', this.loginForm.username);
                        formData.append('password', this.loginForm.password);
                        
                        const response = await axios.post('/auth/login', formData);
                        this.token = response.data.access_token;
                        localStorage.setItem('token', this.token);
                        
                        await this.getCurrentUser();
                    } catch (error) {
                        alert('ë¡œê·¸ì¸ ì‹¤íŒ¨: ' + (error.response?.data?.detail || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
                    } finally {
                        this.loading = false;
                    }
                },
                
                async getCurrentUser() {
                    try {
                        this.user = await this.apiRequest('/auth/me');
                        await this.loadDashboardData();
                    } catch (error) {
                        console.error('ì‚¬ìš©ì ì •ë³´ ë¡œë“œ ì‹¤íŒ¨:', error);
                        this.logout();
                    }
                },
                
                logout() {
                    this.user = null;
                    this.token = null;
                    localStorage.removeItem('token');
                    this.activeTab = 'dashboard';
                },
                
                async loadDashboardData() {
                    try {
                        this.stats = await this.apiRequest('/api/dashboard/stats');
                        await this.loadStores();
                        await this.loadReviews();
                        if (this.user.role === 'admin') {
                            await this.loadUsers();
                        }
                    } catch (error) {
                        console.error('ëŒ€ì‹œë³´ë“œ ë¡œë“œ ì‹¤íŒ¨:', error);
                    }
                },
                
                async loadReviews() {
                    try {
                        this.reviews = await this.apiRequest('/api/reviews');
                    } catch (error) {
                        console.error('ë¦¬ë·° ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
                    }
                },
                
                async loadStores() {
                    try {
                        this.stores = await this.apiRequest('/api/stores');
                    } catch (error) {
                        console.error('ì—…ì²´ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
                    }
                },
                
                async loadUsers() {
                    try {
                        this.users = await this.apiRequest('/api/users');
                    } catch (error) {
                        console.error('ì‚¬ìš©ì ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
                    }
                },
                
                async submitReview() {
                    this.loading = true;
                    this.loadingMessage = 'ë¦¬ë·° ë“±ë¡ ì¤‘...';
                    try {
                        await this.apiRequest('/api/reviews', {
                            method: 'POST',
                            data: this.reviewForm
                        });
                        
                        this.reviewForm = { store_id: '', review_url: '' };
                        this.showReviewForm = false;
                        await this.loadReviews();
                        await this.loadDashboardData();
                        alert('âœ… ë¦¬ë·°ê°€ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    } catch (error) {
                        alert('âŒ ë¦¬ë·° ë“±ë¡ ì‹¤íŒ¨: ' + (error.response?.data?.detail || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
                    } finally {
                        this.loading = false;
                    }
                },
                
                async submitStore() {
                    this.loading = true;
                    this.loadingMessage = 'ì—…ì²´ ë“±ë¡ ì¤‘...';
                    try {
                        await this.apiRequest('/api/stores', {
                            method: 'POST',
                            data: this.storeForm
                        });
                        
                        this.storeForm = { name: '', description: '', location: '' };
                        this.showStoreForm = false;
                        await this.loadStores();
                        alert('âœ… ì—…ì²´ê°€ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    } catch (error) {
                        alert('âŒ ì—…ì²´ ë“±ë¡ ì‹¤íŒ¨: ' + (error.response?.data?.detail || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
                    } finally {
                        this.loading = false;
                    }
                },
                
                async processReview(reviewId) {
                    this.loading = true;
                    this.loadingMessage = 'ë¦¬ë·° ì¶”ì¶œ ì²˜ë¦¬ ì¤‘...';
                    try {
                        await this.apiRequest(`/api/reviews/${reviewId}/process`, {
                            method: 'POST'
                        });
                        
                        alert('ğŸš€ ë¦¬ë·° ì²˜ë¦¬ë¥¼ ì‹œì‘í–ˆìŠµë‹ˆë‹¤! ì ì‹œ í›„ ê²°ê³¼ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.');
                        setTimeout(() => {
                            this.loadReviews();
                            this.loadDashboardData();
                        }, 3000);
                    } catch (error) {
                        alert('âŒ ë¦¬ë·° ì²˜ë¦¬ ì‹¤íŒ¨: ' + (error.response?.data?.detail || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
                    } finally {
                        this.loading = false;
                    }
                },
                
                async processAllPending() {
                    if (!confirm('ëª¨ë“  ëŒ€ê¸°ì¤‘ì¸ ë¦¬ë·°ë¥¼ ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
                    
                    this.loading = true;
                    this.loadingMessage = 'ì „ì²´ ë¦¬ë·° ì²˜ë¦¬ ì¤‘...';
                    try {
                        const pendingReviews = this.reviews.filter(r => r.status === 'pending');
                        for (const review of pendingReviews) {
                            await this.apiRequest(`/api/reviews/${review.id}/process`, {
                                method: 'POST'
                            });
                        }
                        
                        alert(`ğŸš€ ${pendingReviews.length}ê°œ ë¦¬ë·° ì²˜ë¦¬ë¥¼ ì‹œì‘í–ˆìŠµë‹ˆë‹¤!`);
                        setTimeout(() => {
                            this.loadReviews();
                            this.loadDashboardData();
                        }, 5000);
                    } catch (error) {
                        alert('âŒ ì¼ê´„ ì²˜ë¦¬ ì‹¤íŒ¨: ' + (error.response?.data?.detail || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
                    } finally {
                        this.loading = false;
                    }
                },
                
                async setupGoogleSheets() {
                    if (!this.googleSheetForm.sheet_id) {
                        alert('êµ¬ê¸€ ì‹œíŠ¸ IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”');
                        return;
                    }
                    
                    this.loading = true;
                    this.loadingMessage = 'êµ¬ê¸€ ì‹œíŠ¸ ì—°ê²° ì¤‘...';
                    try {
                        await this.apiRequest('/api/google-sheets/setup', {
                            method: 'POST',
                            data: this.googleSheetForm
                        });
                        alert('âœ… êµ¬ê¸€ ì‹œíŠ¸ ì—°ê²° ì„±ê³µ!');
                    } catch (error) {
                        alert('âŒ êµ¬ê¸€ ì‹œíŠ¸ ì—°ê²° ì‹¤íŒ¨: ' + (error.response?.data?.detail || 'ì¸ì¦ íŒŒì¼ì„ ë¨¼ì € ì—…ë¡œë“œí•´ì£¼ì„¸ìš”'));
                    } finally {
                        this.loading = false;
                    }
                },
                
                async syncWithGoogleSheets() {
                    this.loading = true;
                    this.loadingMessage = 'êµ¬ê¸€ ì‹œíŠ¸ ë™ê¸°í™” ì¤‘...';
                    try {
                        const result = await this.apiRequest('/api/google-sheets/sync');
                        alert('âœ… ' + result.message);
                        await this.loadReviews();
                        await this.loadDashboardData();
                    } catch (error) {
                        alert('âŒ ë™ê¸°í™” ì‹¤íŒ¨: ' + (error.response?.data?.detail || 'êµ¬ê¸€ ì‹œíŠ¸ ì„¤ì •ì„ í™•ì¸í•´ì£¼ì„¸ìš”'));
                    } finally {
                        this.loading = false;
                    }
                },
                
                handleCredentialsUpload(event) {
                    this.credentialsFile = event.target.files[0];
                },
                
                viewReviewDetail(review) {
                    this.selectedReview = review;
                },
                
                getStatusText(status) {
                    const statusMap = {
                        'pending': 'â³ ëŒ€ê¸°ì¤‘',
                        'processing': 'ğŸ”„ ì²˜ë¦¬ì¤‘',
                        'completed': 'âœ… ì™„ë£Œ',
                        'failed': 'âŒ ì‹¤íŒ¨'
                    };
                    return statusMap[status] || status;
                },
                
                getStatusColor(status) {
                    const colorMap = {
                        'pending': 'bg-yellow-100 text-yellow-800',
                        'processing': 'bg-blue-100 text-blue-800',
                        'completed': 'bg-green-100 text-green-800',
                        'failed': 'bg-red-100 text-red-800'
                    };
                    return colorMap[status] || 'bg-gray-100 text-gray-800';
                },
                
                getStoreReviewCount(storeId) {
                    return this.reviews.filter(r => r.store_name === this.stores.find(s => s.id === storeId)?.name).length;
                },
                
                formatDate(dateString) {
                    return new Date(dateString).toLocaleString('ko-KR');
                }
            }
        }).mount('#app');
    </script>
</body>
</html>